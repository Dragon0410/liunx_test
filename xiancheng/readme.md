# 进程和线程的区别？什么时候用进程？什么时候用线程？

**进程**是并发执行的程序，是程序的实体。在执行过程中分配和管理资源的基本单位，是动态概念，竞争计算机系统资源的基本单位。
##### 一个进程至少具有5种基本状态：初始态、执行状态、等待（阻塞）状态、就绪状态、终止状态
    1、初始状态：进程刚被创建，由于其他进程正占有CPU所以得不到执行，只能处于初始状态。
    2、执行状态：任意时刻处于执行状态的进程只能有一个。
    3、就绪状态：只有处于就绪状态的经过调度才能到执行状态
    4、等待状态：进程等待某件事件完成
    5、停止状态：进程结束


**线程**是进程的一个执行单元，是进程内调度实体。比进程更小的独立运行执行的基本单位，线程也被称为轻量级进程。

    一个进程可以有一个或多个线程，同一进程中的多个线程将共享该进程中的全部系统资源，如虚拟地址空间，文件描述符和信号处理等等。但同一进程中的多个线程有各自的调用栈和线程本地存储

    系统为线程分配一个线程控制块TCB（Thread Control Block）,将所有用于控制和管理线程的信息记录在线程的控制块中，TCB中通常包括：
        线程标志符
        一组寄存器
        线程运行状态
        优先级
        线程专有存储区
        信号屏蔽

**协程Coroutine**又称微线程，是一种比线程更加轻量级的存在，不是被操作系统内核所管理，而是完全由程序控制。1，协程可以比作子程序，子程序内部可以中断，切换执行。协程之间的切换不需要涉及任何系统调用或者任何阻塞调用。2，协程只在线程中执行，是子程序之间的切换，发生在用户态上，线程的阻塞状态是由操作系统内核完成，发生在内核态上，所有协程更节省创建及切换开销. 3，协程中不存在同时写变量冲突，不需要来自操作系统的支持。

协程适用于IO阻塞且需要大量并发的场景，当发生IO阻塞，由协程的调度器进行调度，通过将数据量yield掉，并记录当前栈上的数据，则是完成后再通过线程恢复栈，并把阻塞结果放在这个线程上运行。

## 操作系统对把CPU控制权在不同进程之间交换执行的机制成为上下文切换（context switch），即保存当前进程的上下文，恢复新进程的上下文，然后将CPU控制权转移到新进程，新进程就会从上次停止的地方开始


### 1、需要频繁创建及销毁的有限使用线程；对于进程来说，创建及销毁一个进程代价比较大；
### 2、线程切换速度快，所以需要大量计算，切换频繁时用线程，比较耗时的操作使用线程可以提高应用程序的相应；
### 3、对CPU系统的效率使用上，线程更占优势。需要多机分布的用进程，多核分布的用线程；
### 4、并行操作时使用线程，比如C/S架构的服务器端并发线程相应用户的请求；
### 5、需要更稳定安全时，适合选择进程，需要速度时，选择线程。


    需要更稳定安全的解释：一个线程的意外终止会影响整个进程的正常运行，但是一个进程的意外终止不会影响其他的进程的运行


### 一个线程可以多个协程，一个进程也是可以多个协程
### 线程进程是同步机制，协程是异步
### 协程保留上一次调用的涨停，每次过程重入时，相当于进入上一步的调用状态
### 线程时抢占式，协程非抢占式的，协程需要自己释放使用权切换其他的协程
### 线程是协程的资源。协程通过interceptor来简介使用线程这个资源